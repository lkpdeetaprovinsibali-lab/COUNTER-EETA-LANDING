<!DOCTYPE html>
<html lang="id" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COUNTER EETA - Sistem Akuntansi Keuangan Daerah</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --color-primary:       #1e3a8a;
            --color-primary-dark:  #1e40af;
            --color-primary-light: #3b82f6;
            --color-accent:        #d97706;
            --color-accent-light:  #fbbf24;

            --color-success: #059669;
            --color-warning: #d97706;
            --color-danger:  #dc2626;
            --color-info:    #0891b2;

            --color-bg:           #f8fafc;
            --color-surface:      #ffffff;
            --color-surface-alt:  #f1f5f9;
            --color-border:       #e2e8f0;
            --color-border-dark:  #cbd5e1;
            --color-text:         #0f172a;
            --color-text-secondary: #475569;
            --color-text-muted:   #64748b;

            --font-primary: 'Plus Jakarta Sans', 'Segoe UI', system-ui, sans-serif;
            --font-mono:    'DM Mono', 'Courier New', monospace;

            --spacing-xs:  0.25rem; --spacing-sm:  0.5rem;
            --spacing-md:  0.75rem; --spacing-lg:  1rem;
            --spacing-xl:  1.5rem;  --spacing-2xl: 2rem;
            --spacing-3xl: 3rem;

            --radius-sm: 0.25rem; --radius-md: 0.375rem;
            --radius-lg: 0.5rem;  --radius-xl: 0.75rem;

            --shadow-xs: 0 1px 2px 0 rgba(0,0,0,.05);
            --shadow-sm: 0 1px 3px 0 rgba(0,0,0,.1), 0 1px 2px 0 rgba(0,0,0,.06);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,.1), 0 2px 4px -1px rgba(0,0,0,.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,.1), 0 10px 10px -5px rgba(0,0,0,.04);

            --transition-fast: 150ms ease;
            --transition-base: 200ms ease;
            --transition-slow: 300ms ease;
        }

        [data-theme="dark"] {
            --color-bg:             #0f172a;
            --color-surface:        #1e293b;
            --color-surface-alt:    #334155;
            --color-border:         #475569;
            --color-border-dark:    #334155;
            --color-text:           #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-text-muted:     #94a3b8;
            --shadow-xs: 0 1px 2px 0 rgba(0,0,0,.3);
            --shadow-sm: 0 1px 3px 0 rgba(0,0,0,.4), 0 1px 2px 0 rgba(0,0,0,.3);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,.4), 0 2px 4px -1px rgba(0,0,0,.3);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,.5), 0 4px 6px -2px rgba(0,0,0,.4);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,.6), 0 10px 10px -5px rgba(0,0,0,.5);
        }

        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-primary);
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .bg-gradient {
            position: fixed; inset: 0;
            background:
                radial-gradient(ellipse at top, rgba(30,58,138,.08), transparent 60%),
                radial-gradient(ellipse at bottom right, rgba(217,119,6,.06), transparent 60%);
            pointer-events: none; z-index: 0;
        }
        .bg-grid {
            position: fixed; inset: 0;
            background-image:
                linear-gradient(rgba(30,58,138,.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30,58,138,.02) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none; z-index: 1;
        }
        [data-theme="dark"] .bg-gradient {
            background:
                radial-gradient(ellipse at top, rgba(59,130,246,.15), transparent 60%),
                radial-gradient(ellipse at bottom right, rgba(251,191,36,.1), transparent 60%);
        }
        [data-theme="dark"] .bg-grid {
            background-image:
                linear-gradient(rgba(148,163,184,.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(148,163,184,.03) 1px, transparent 1px);
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           UPDATE NOTIFICATION BANNER
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .update-banner {
            position: relative; z-index: 200;
            background: linear-gradient(135deg, #0f2044 0%, #1e3a8a 50%, #1d4ed8 100%);
            border-bottom: 1px solid rgba(255,255,255,.08);
            overflow: hidden;
            animation: bannerSlide .4s ease both;
        }
        .update-banner.hidden { display: none; }

        @keyframes bannerSlide {
            from { transform: translateY(-100%); opacity: 0; }
            to   { transform: translateY(0);     opacity: 1; }
        }
        .update-banner::before {
            content: '';
            position: absolute; inset: 0;
            background: linear-gradient(
                105deg,
                transparent 35%,
                rgba(255,255,255,.04) 50%,
                transparent 65%
            );
            background-size: 200% 100%;
            animation: shimmer 3s linear infinite;
        }
        @keyframes shimmer {
            from { background-position: 200% center; }
            to   { background-position: -200% center; }
        }

        /* ‚îÄ‚îÄ FIXED: Banner inner layout ‚îÄ‚îÄ */
        .update-banner-inner {
            max-width: 1100px; margin: 0 auto;
            padding: 8px var(--spacing-xl);
            display: flex; align-items: center; gap: var(--spacing-md);
            min-height: 44px;
            position: relative; z-index: 1;
            flex-wrap: nowrap;
        }

        .update-badge {
            flex-shrink: 0;
            display: inline-flex; align-items: center; gap: .3rem;
            background: rgba(255,255,255,.15);
            border: 1px solid rgba(255,255,255,.25);
            border-radius: 2rem;
            padding: .2rem .7rem;
            font-size: .6875rem; font-weight: 800;
            letter-spacing: .08em; text-transform: uppercase;
            color: #fbbf24;
            line-height: 1;
        }
        .update-badge-dot {
            width: 6px; height: 6px; border-radius: 50%;
            background: #34d399;
            animation: badgePulse 1.8s ease infinite;
            flex-shrink: 0;
        }
        @keyframes badgePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50%       { opacity: .5; transform: scale(.75); }
        }

        /* ‚îÄ‚îÄ FIXED: Text area takes remaining space, single row ‚îÄ‚îÄ */
        .update-text {
            flex: 1; min-width: 0;
            display: flex; flex-direction: column; align-items: flex-start;
            gap: 4px;
        }
        .update-headline {
            font-size: .875rem; font-weight: 700; color: white;
            white-space: nowrap;
        }
        .update-highlights {
            display: flex; flex-wrap: nowrap; gap: .375rem;
            align-items: center; overflow: hidden;
        }
        @media (max-width: 900px) {
            .update-highlights .update-chip:nth-child(n+3) { display: none; }
        }
        @media (max-width: 760px) {
            .update-highlights { display: none; }
        }
        .update-chip {
            display: inline-flex; align-items: center; gap: .25rem;
            padding: .2rem .625rem;
            background: rgba(255,255,255,.1);
            border: 1px solid rgba(255,255,255,.15);
            border-radius: .375rem;
            font-size: .7rem; font-weight: 600; color: rgba(255,255,255,.85);
            white-space: nowrap; line-height: 1.4;
        }

        /* ‚îÄ‚îÄ FIXED: CTA and dismiss always right-aligned ‚îÄ‚îÄ */
        .update-actions {
            flex-shrink: 0;
            display: flex; align-items: center; gap: var(--spacing-sm);
        }
        .update-cta {
            display: inline-flex; align-items: center; gap: .375rem;
            padding: .4rem 1rem;
            background: #fbbf24; color: #1e3a8a;
            border-radius: .375rem; border: none;
            font-size: .8125rem; font-weight: 800;
            font-family: var(--font-primary);
            text-decoration: none; cursor: pointer;
            transition: all .18s ease;
            white-space: nowrap; line-height: 1;
        }
        .update-cta:hover { background: #fde68a; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.2); }

        .update-dismiss {
            width: 28px; height: 28px;
            background: rgba(255,255,255,.08);
            border: 1px solid rgba(255,255,255,.15);
            border-radius: .375rem;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: rgba(255,255,255,.6);
            font-size: .75rem; transition: all .18s ease;
            flex-shrink: 0;
        }
        .update-dismiss:hover { background: rgba(255,255,255,.18); color: white; }

        /* ‚îÄ‚îÄ FIXED: HEADER ‚îÄ‚îÄ */
        .header {
            position: sticky; top: 0; z-index: 100;
            background: var(--color-surface);
            border-bottom: 2px solid var(--color-primary);
            box-shadow: var(--shadow-sm);
        }
        .header-inner {
            max-width: 1100px; margin: 0 auto; padding: 0 var(--spacing-xl);
            display: flex; justify-content: space-between; align-items: center;
            height: 68px; /* fixed height for consistent alignment */
        }
        .logo { display: flex; align-items: center; gap: var(--spacing-md); }
        .logo-icon {
            width: 44px; height: 44px; flex-shrink: 0;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            border-radius: var(--radius-md);
            display: flex; align-items: center; justify-content: center;
            color: white; box-shadow: var(--shadow-md);
            font-size: 1rem; font-weight: 800;
            font-family: var(--font-mono); letter-spacing: -0.05em;
        }
        .logo-text { display: flex; flex-direction: column; line-height: 1.25; }
        .logo-title { font-size: 1.25rem; font-weight: 700; color: var(--color-primary); letter-spacing: -0.025em; }
        [data-theme="dark"] .logo-title { color: var(--color-primary-light); }
        .logo-subtitle { font-size: 0.75rem; color: var(--color-text-secondary); font-weight: 500; }

        /* ‚îÄ‚îÄ FIXED: Header right side perfectly centered ‚îÄ‚îÄ */
        .header-actions {
            display: flex; align-items: center; gap: var(--spacing-sm);
        }
        .badge {
            display: inline-flex; align-items: center;
            padding: 0.25rem 0.75rem;
            background: var(--color-primary); color: white;
            border-radius: var(--radius-md);
            font-size: 0.75rem; font-weight: 600; letter-spacing: 0.025em;
            box-shadow: var(--shadow-xs); line-height: 1;
            height: 28px;
        }
        .theme-toggle {
            width: 36px; height: 36px;
            border: 1px solid var(--color-border); background: var(--color-surface);
            border-radius: var(--radius-md);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all var(--transition-base);
            font-size: 1rem; flex-shrink: 0;
        }
        .theme-toggle:hover { background: var(--color-surface-alt); border-color: var(--color-primary); }

        .container { max-width: 780px; margin: 0 auto; padding: 0 var(--spacing-xl); }
        .container-wide { max-width: 1100px; margin: 0 auto; padding: 0 var(--spacing-xl); }

        .main-content { position: relative; z-index: 2; padding: var(--spacing-3xl) 0 var(--spacing-2xl); }

        .state { display: none; }
        .state.active { display: block; }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--spacing-3xl);
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.5s ease-out both;
        }

        /* ‚îÄ‚îÄ LOADING STATE ‚îÄ‚îÄ */
        #loadingState .card-inner {
            display: flex; flex-direction: column;
            align-items: center; gap: var(--spacing-xl);
            padding: var(--spacing-2xl) 0; text-align: center;
        }
        .loading-spinner {
            width: 52px; height: 52px;
            border: 3px solid var(--color-border);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        .loading-label { font-size: 1rem; font-weight: 600; color: var(--color-text); }
        .loading-sub   { font-size: 0.875rem; color: var(--color-text-muted); }

        /* ‚îÄ‚îÄ WAITING STATE ‚îÄ‚îÄ */
        #waitingState .card-inner {
            display: flex; flex-direction: column;
            align-items: center; gap: var(--spacing-xl);
            padding: var(--spacing-2xl) 0; text-align: center;
        }
        .radar-wrap { position: relative; width: 100px; height: 100px; }
        .radar-ring {
            position: absolute; inset: 0; border-radius: 50%;
            border: 2px solid var(--color-primary); opacity: 0;
            animation: radarPulse 2s ease-out infinite;
        }
        .radar-ring:nth-child(2) { animation-delay: 0.66s; }
        .radar-ring:nth-child(3) { animation-delay: 1.33s; }
        .radar-core {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .radar-dot {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem; box-shadow: var(--shadow-md);
        }
        .waiting-label { font-size: 1.125rem; font-weight: 700; color: var(--color-text); }
        .waiting-sub   { font-size: 0.875rem; color: var(--color-text-muted); max-width: 340px; line-height: 1.6; }
        .wait-bar-wrap { width: 100%; max-width: 320px; }
        .wait-bar-label {
            display: flex; justify-content: space-between;
            font-size: 0.8rem; color: var(--color-text-muted); margin-bottom: var(--spacing-xs);
        }
        .wait-bar-track { height: 6px; background: var(--color-border); border-radius: 3px; overflow: hidden; }
        .wait-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
            border-radius: 3px; width: 100%; transition: width 1s linear;
        }
        .wait-secs {
            font-size: 2.25rem; font-weight: 800; font-family: var(--font-mono);
            color: var(--color-primary); letter-spacing: -0.04em;
        }
        [data-theme="dark"] .wait-secs { color: var(--color-primary-light); }
        .wait-cancel {
            background: none; border: none; font-size: 0.8125rem; color: var(--color-text-muted);
            cursor: pointer; font-family: var(--font-primary); text-decoration: underline; padding: 0;
            transition: color var(--transition-fast);
        }
        .wait-cancel:hover { color: var(--color-danger); }

        /* ‚îÄ‚îÄ SUCCESS STATE ‚îÄ‚îÄ */
        #successState .card-inner {
            display: flex; flex-direction: column;
            align-items: center; gap: var(--spacing-xl);
            padding: var(--spacing-2xl) 0; text-align: center;
        }
        .check-ring {
            width: 80px; height: 80px;
            background: rgba(5,150,105,.1); border: 2px solid var(--color-success);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 2rem; animation: scaleIn 0.4s cubic-bezier(.34,1.56,.64,1) both;
        }
        .success-label { font-size: 1.375rem; font-weight: 700; color: var(--color-text); }
        .countdown-ring { position: relative; width: 72px; height: 72px; }
        .countdown-num {
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-weight: 700; font-family: var(--font-mono); color: var(--color-primary);
        }
        .countdown-svg { transform: rotate(-90deg); }
        .countdown-track { fill: none; stroke: var(--color-border); stroke-width: 4; }
        .countdown-arc  {
            fill: none; stroke: var(--color-primary); stroke-width: 4;
            stroke-linecap: round; stroke-dasharray: 201; stroke-dashoffset: 0;
            transition: stroke-dashoffset 1s linear;
        }
        .redirect-sub { font-size: 0.9rem; color: var(--color-text-muted); }

        /* ‚îÄ‚îÄ NOT RUNNING STATE ‚îÄ‚îÄ */
        .section-eyebrow {
            display: inline-flex; align-items: center; gap: var(--spacing-sm);
            font-size: 0.75rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase;
            color: var(--color-primary); background: rgba(30,58,138,.07);
            border: 1px solid rgba(30,58,138,.15);
            border-radius: var(--radius-md); padding: 0.25rem 0.75rem;
            margin-bottom: var(--spacing-lg);
        }
        [data-theme="dark"] .section-eyebrow { background: rgba(59,130,246,.12); border-color: rgba(59,130,246,.25); color: var(--color-primary-light); }

        .hero { text-align: center; margin-bottom: var(--spacing-3xl); animation: fadeInUp 0.5s ease-out both; }
        .hero-title {
            font-size: clamp(1.75rem, 4vw, 2.5rem); font-weight: 800;
            line-height: 1.15; letter-spacing: -0.03em; margin-bottom: var(--spacing-lg);
        }
        .title-main { display: block; color: var(--color-text); }
        .title-accent {
            display: block;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .hero-desc { font-size: 0.9375rem; color: var(--color-text-secondary); max-width: 520px; margin: 0 auto; line-height: 1.7; }

        .status-bar {
            display: flex; align-items: center; gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-lg);
            background: rgba(220, 38, 38, .06); border: 1px solid rgba(220, 38, 38, .2);
            border-radius: var(--radius-lg); font-size: 0.875rem; font-weight: 500; color: var(--color-danger);
            margin-bottom: var(--spacing-xl);
        }
        .status-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: var(--color-danger); flex-shrink: 0; animation: pulse 2s ease infinite;
        }

        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            gap: var(--spacing-sm); padding: 0.6875rem 1.5rem;
            border-radius: var(--radius-lg); font-weight: 600; font-size: 0.9375rem;
            border: none; cursor: pointer; transition: all var(--transition-base);
            text-decoration: none; font-family: var(--font-primary); white-space: nowrap;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white; width: 100%; padding: 0.9375rem; font-size: 1rem; box-shadow: var(--shadow-md);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .btn-primary:active { transform: translateY(0); }
        .btn-outline {
            background: var(--color-surface); color: var(--color-text);
            border: 1px solid var(--color-border); width: 100%;
            padding: 0.9375rem; font-size: 1rem; box-shadow: var(--shadow-xs);
        }
        .btn-outline:hover { background: var(--color-surface-alt); border-color: var(--color-primary); transform: translateY(-1px); box-shadow: var(--shadow-sm); }
        .btn-success {
            background: var(--color-success); color: white;
            width: 100%; padding: 0.9375rem; font-size: 1rem; box-shadow: var(--shadow-sm);
        }
        .btn-success:hover { background: #047857; transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .btn-sm { padding: 0.5rem 1.125rem; font-size: 0.875rem; width: auto; }

        .cta-group { display: flex; flex-direction: column; gap: var(--spacing-md); margin-bottom: var(--spacing-2xl); }

        .hint-box {
            display: flex; gap: var(--spacing-md); padding: var(--spacing-lg);
            background: rgba(5,150,105,.06); border: 1px solid rgba(5,150,105,.2);
            border-radius: var(--radius-lg); font-size: 0.875rem; color: var(--color-text-secondary);
            margin-bottom: var(--spacing-2xl);
        }
        .hint-icon { font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }
        .hint-box strong { color: var(--color-text); }

        .divider {
            display: flex; align-items: center; gap: var(--spacing-lg);
            margin: var(--spacing-2xl) 0; color: var(--color-text-muted);
            font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em;
        }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--color-border); }

        .feature-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-2xl); }
        .feat {
            display: flex; align-items: flex-start; gap: var(--spacing-md); padding: var(--spacing-lg);
            background: var(--color-surface-alt); border: 1px solid var(--color-border);
            border-radius: var(--radius-lg); transition: all var(--transition-base);
        }
        .feat:hover { border-color: var(--color-primary); box-shadow: var(--shadow-sm); }
        .feat-icon {
            width: 36px; height: 36px; flex-shrink: 0;
            background: rgba(30,58,138,.08); border-radius: var(--radius-md);
            display: flex; align-items: center; justify-content: center; font-size: 1rem;
        }
        [data-theme="dark"] .feat-icon { background: rgba(59,130,246,.12); }
        .feat-title { font-size: 0.875rem; font-weight: 600; color: var(--color-text); margin-bottom: 2px; }
        .feat-desc  { font-size: 0.8125rem; color: var(--color-text-muted); line-height: 1.5; }

        .download-strip {
            display: flex; align-items: center; justify-content: space-between;
            gap: var(--spacing-lg); padding: var(--spacing-xl);
            background: linear-gradient(135deg, rgba(30,58,138,.05), rgba(217,119,6,.04));
            border: 1px solid var(--color-border); border-radius: var(--radius-lg); margin-bottom: var(--spacing-xl);
        }
        .download-info { flex: 1; min-width: 0; }
        .download-title { font-size: 0.9375rem; font-weight: 700; color: var(--color-text); margin-bottom: 2px; }
        .download-meta  { font-size: 0.8125rem; color: var(--color-text-muted); }
        .btn-accent {
            background: var(--color-accent); color: white; padding: 0.6875rem 1.25rem;
            font-size: 0.9375rem; white-space: nowrap; flex-shrink: 0; box-shadow: var(--shadow-sm);
            border: none; cursor: pointer; border-radius: var(--radius-lg);
            font-weight: 600; font-family: var(--font-primary);
            display: inline-flex; align-items: center; gap: var(--spacing-sm);
            text-decoration: none; transition: all var(--transition-base);
        }
        .btn-accent:hover { background: #b45309; transform: translateY(-2px); box-shadow: var(--shadow-md); }

        .collapse-trigger {
            display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-lg);
            background: var(--color-surface-alt); border: 1px solid var(--color-border);
            border-radius: var(--radius-lg); cursor: pointer;
            font-weight: 600; font-size: 0.9rem; color: var(--color-text-secondary);
            transition: all var(--transition-base); user-select: none;
        }
        .collapse-trigger:hover { border-color: var(--color-primary); color: var(--color-text); }
        .collapse-arrow { font-size: 0.875rem; transition: transform var(--transition-base); }
        .collapse-arrow.open { transform: rotate(180deg); }
        .collapse-body { overflow: hidden; max-height: 0; transition: max-height 0.35s ease; }
        .collapse-body.open { max-height: 1200px; }
        .collapse-inner { padding-top: var(--spacing-lg); display: flex; flex-direction: column; gap: var(--spacing-md); }

        .steps-list { display: flex; flex-direction: column; gap: var(--spacing-md); }
        .step-item {
            display: flex; align-items: flex-start; gap: var(--spacing-lg); padding: var(--spacing-lg);
            background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-lg);
        }
        .step-num {
            width: 32px; height: 32px; flex-shrink: 0;
            background: var(--color-primary); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 0.875rem; font-family: var(--font-mono);
        }
        .step-title { font-weight: 600; font-size: 0.9rem; color: var(--color-text); margin-bottom: 2px; }
        .step-desc  { font-size: 0.8125rem; color: var(--color-text-muted); line-height: 1.5; }

        .info-note {
            display: flex; gap: var(--spacing-md); padding: var(--spacing-lg);
            background: rgba(30,58,138,.05); border: 1px solid rgba(30,58,138,.15);
            border-radius: var(--radius-lg); font-size: 0.875rem; color: var(--color-text-secondary); line-height: 1.6;
        }
        [data-theme="dark"] .info-note { background: rgba(59,130,246,.08); border-color: rgba(59,130,246,.2); }
        .info-note-icon { font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }

        .how-card {
            background: var(--color-surface); border: 1px solid var(--color-border);
            border-radius: var(--radius-xl); padding: var(--spacing-2xl); box-shadow: var(--shadow-sm);
            margin-top: var(--spacing-xl); animation: fadeInUp 0.5s ease-out 0.15s both;
        }
        .how-card h3 { font-size: 1.125rem; font-weight: 700; margin-bottom: var(--spacing-xl); color: var(--color-text); }
        .how-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md); }
        .how-item {
            padding: var(--spacing-lg); background: var(--color-surface-alt);
            border: 1px solid var(--color-border); border-radius: var(--radius-lg);
        }
        .how-item-head {
            display: flex; align-items: center; gap: var(--spacing-sm);
            font-weight: 600; font-size: 0.875rem; color: var(--color-primary); margin-bottom: var(--spacing-sm);
        }
        [data-theme="dark"] .how-item-head { color: var(--color-primary-light); }
        .how-item p { font-size: 0.8125rem; color: var(--color-text-muted); line-height: 1.6; }

        .footer {
            position: relative; z-index: 10; padding: var(--spacing-2xl) 0; margin-top: var(--spacing-3xl);
            background: var(--color-surface); border-top: 2px solid var(--color-primary);
        }
        .footer-content { display: flex; flex-direction: column; align-items: center; gap: var(--spacing-lg); text-align: center; }
        .footer-brand strong { font-size: 1.125rem; color: var(--color-primary); font-weight: 700; letter-spacing: -0.025em; display: block; }
        [data-theme="dark"] .footer-brand strong { color: var(--color-primary-light); }
        .footer-brand span { font-size: 0.875rem; color: var(--color-text-secondary); font-weight: 500; }
        .footer-info { color: var(--color-text-secondary); font-size: 0.8125rem; }
        .footer-info p { margin: var(--spacing-xs) 0; }
        .footer-note { font-style: italic; opacity: .8; }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn  { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        @keyframes radarPulse {
            0%   { transform: scale(0.5); opacity: .8; }
            100% { transform: scale(2);   opacity: 0; }
        }

        @media (max-width: 640px) {
            .card { padding: var(--spacing-xl); }
            .feature-grid { grid-template-columns: 1fr; }
            .how-grid { grid-template-columns: 1fr; }
            .download-strip { flex-direction: column; align-items: flex-start; }
            .badge { display: none; }
            .update-badge { display: none; }
            .update-highlights { display: none; }
            .update-headline { font-size: .8125rem; white-space: normal; }
            .update-banner-inner { min-height: 44px; gap: var(--spacing-sm); }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="bg-grid"></div>

    <!-- UPDATE NOTIFICATION BANNER -->
    <div class="update-banner" id="updateBanner">
        <div class="update-banner-inner">
            <div class="update-badge">
                <div class="update-badge-dot"></div>
                Baru
            </div>

            <div class="update-text">
                <span class="update-headline">COUNTER EETA v0.3.0 tersedia!</span>
                <div class="update-highlights">
                    <span class="update-chip">üìñ Panduan CALK interaktif</span>
                    <span class="update-chip">‚ñ∂ Demo animasi 7 langkah</span>
                    <span class="update-chip">üìã Panduan persiapan Uji PA</span>
                    <span class="update-chip">üîß 4 bug fix stabilitas</span>
                </div>
            </div>

            <!-- Actions grouped together -->
            <div class="update-actions">
                <a href="https://github.com/lkpdeetaprovinsibali-lab/COUNTER-EETA-LANDING/releases/tag/v0.3.0"
                   class="update-cta" target="_blank" rel="noopener noreferrer">
                    üì• Download
                </a>
                <button class="update-dismiss" onclick="dismissBanner()" title="Tutup notifikasi">‚úï</button>
            </div>
        </div>
    </div>

    <header class="header">
        <div class="header-inner">
            <div class="logo">
                <div class="logo-icon">CE</div>
                <div class="logo-text">
                    <span class="logo-title">COUNTER EETA</span>
                    <span class="logo-subtitle">Pemerintah Provinsi Bali</span>
                </div>
            </div>
            <div class="header-actions">
                <span class="badge">v0.3.0</span>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle tema">
                    <span id="themeIcon">üåô</span>
                </button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">

            <!-- STATE 1: Cek awal -->
            <div class="state active" id="loadingState">
                <div class="card">
                    <div class="card-inner">
                        <div class="loading-spinner"></div>
                        <div>
                            <p class="loading-label">Memeriksa aplikasi‚Ä¶</p>
                            <p class="loading-sub">Mohon tunggu sebentar</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STATE 2: Menunggu app dibuka (30 detik) -->
            <div class="state" id="waitingState">
                <div class="card">
                    <div class="card-inner">
                        <div class="radar-wrap">
                            <div class="radar-ring"></div>
                            <div class="radar-ring"></div>
                            <div class="radar-ring"></div>
                            <div class="radar-core">
                                <div class="radar-dot">üîç</div>
                            </div>
                        </div>
                        <div class="waiting-label">Menunggu Aplikasi Dibuka‚Ä¶</div>
                        <p class="waiting-sub">
                            Silakan klik <strong>"Open"</strong> atau <strong>"Buka"</strong> pada dialog browser,
                            lalu tunggu aplikasi menyala.
                        </p>
                        <div class="wait-secs" id="waitSecs">30</div>
                        <div class="wait-bar-wrap">
                            <div class="wait-bar-label">
                                <span>Mendeteksi otomatis‚Ä¶</span>
                                <span id="waitBarPct">100%</span>
                            </div>
                            <div class="wait-bar-track">
                                <div class="wait-bar-fill" id="waitBarFill"></div>
                            </div>
                        </div>
                        <button class="wait-cancel" onclick="cancelWaiting()">Batalkan & kembali</button>
                    </div>
                </div>
            </div>

            <!-- STATE 3: Aplikasi terdeteksi -->
            <div class="state" id="successState">
                <div class="card">
                    <div class="card-inner">
                        <div class="check-ring">‚úì</div>
                        <div class="success-label">Aplikasi Terdeteksi!</div>
                        <div class="countdown-ring">
                            <svg class="countdown-svg" width="72" height="72" viewBox="0 0 72 72">
                                <circle class="countdown-track" cx="36" cy="36" r="32"/>
                                <circle class="countdown-arc" id="countdownArc" cx="36" cy="36" r="32"/>
                            </svg>
                            <div class="countdown-num" id="countdown">3</div>
                        </div>
                        <p class="redirect-sub">Mengarahkan ke aplikasi dalam beberapa saat‚Ä¶</p>
                        <button class="btn btn-success btn-sm" onclick="redirectNow()">Buka Sekarang ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- STATE 4: Aplikasi belum berjalan -->
            <div class="state" id="notRunningState">

                <div class="hero">
                    <div style="display:flex;justify-content:center;margin-bottom:var(--spacing-lg)">
                        <span class="section-eyebrow">Sistem Pembantu Penyusunan Laporan Keuangan Pemerintah Daerah</span>
                    </div>
                    <h1 class="hero-title">
                        <span class="title-main">Analisis Laporan Keuangan</span>
                        <span class="title-accent">Otomatis & Profesional</span>
                    </h1>
                    <p class="hero-desc">
                        Platform pengolah LKPD berbasis CALK ‚Äî dari pivot otomatis,
                        tabel Word, hingga grafik visual dalam satu klik.
                    </p>
                </div>

                <div class="card">
                    <div class="status-bar">
                        <div class="status-dot"></div>
                        Aplikasi belum berjalan di komputer ini
                    </div>

                    <div class="cta-group">
                        <a href="counter-eeta://launch" class="btn btn-primary" id="launchBtn"
                           onclick="onLaunchClick(event)">
                            üöÄ &nbsp;Buka Aplikasi COUNTER EETA
                        </a>
                        <button class="btn btn-outline" onclick="reloadPage()">
                            üîÑ &nbsp;Coba Lagi / Refresh
                        </button>
                    </div>

                    <div class="hint-box">
                        <span class="hint-icon">üí°</span>
                        <div>
                            Setelah klik tombol di atas, browser akan meminta konfirmasi ‚Äî
                            klik <strong>"Open"</strong> atau <strong>"Buka"</strong>.
                            Halaman ini otomatis mendeteksi selama <strong>30 detik</strong>.
                        </div>
                    </div>

                    <div class="divider">Belum punya aplikasinya?</div>

                    <div class="feature-grid">
                        <div class="feat">
                            <div class="feat-icon">‚ö°</div>
                            <div>
                                <div class="feat-title">Fitur Canggih</div>
                                <div class="feat-desc">Generasi CALK dan Uji PA secara otomatis dalam hitungan detik</div>
                            </div>
                        </div>
                        <div class="feat">
                            <div class="feat-icon">üìä</div>
                            <div>
                                <div class="feat-title">Export Lengkap</div>
                                <div class="feat-desc">Generasi CALK dalam bentuk Word dan Kertas Kerja Uji PA dalam bentuk Excel dan PDF</div>
                            </div>
                        </div>
                        <div class="feat">
                            <div class="feat-icon">üîí</div>
                            <div>
                                <div class="feat-title">Data Lokal & Aman</div>
                                <div class="feat-desc">Semua diproses di komputer secara lokal, tidak ada melalui internet</div>
                            </div>
                        </div>
                        <div class="feat">
                            <div class="feat-icon">üíª</div>
                            <div>
                                <div class="feat-title">Offline Ready</div>
                                <div class="feat-desc">Bekerja tanpa internet setelah terinstall</div>
                            </div>
                        </div>
                    </div>

                    <div class="download-strip">
                        <div class="download-info">
                            <div class="download-title">Download COUNTER EETA v0.3.0</div>
                            <div class="download-meta">~50 MB &nbsp;¬∑&nbsp; Windows 10/11 &nbsp;¬∑&nbsp; Tanggal Rilis Terbaru: 19 Februari 2026</div>
                        </div>
                        <a href="https://github.com/lkpdeetaprovinsibali-lab/COUNTER-EETA-LANDING/releases"
                           class="btn-accent" target="_blank" rel="noopener noreferrer">
                            üì• &nbsp;Download
                        </a>
                    </div>

                    <div>
                        <div class="collapse-trigger" onclick="toggleCollapse()">
                            <span>‚ùì &nbsp;Tombol "Buka Aplikasi" tidak bekerja?</span>
                            <span class="collapse-arrow" id="collapseArrow">‚ñº</span>
                        </div>
                        <div class="collapse-body" id="collapseBody">
                            <div class="collapse-inner">
                                <div class="steps-list">
                                    <div class="step-item">
                                        <div class="step-num">1</div>
                                        <div>
                                            <div class="step-title">Cari file <code>CounterEETA.exe</code></div>
                                            <div class="step-desc">Biasanya ada di folder Downloads atau Desktop</div>
                                        </div>
                                    </div>
                                    <div class="step-item">
                                        <div class="step-num">2</div>
                                        <div>
                                            <div class="step-title">Double-click file .exe</div>
                                            <div class="step-desc">Izinkan jika muncul SmartScreen Windows</div>
                                        </div>
                                    </div>
                                    <div class="step-item">
                                        <div class="step-num">3</div>
                                        <div>
                                            <div class="step-title">Klik "Coba Lagi" di atas</div>
                                            <div class="step-desc">Setelah app terbuka, klik refresh untuk auto-redirect</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="info-note">
                                    <span class="info-note-icon">‚ÑπÔ∏è</span>
                                    <span>
                                        Tombol otomatis hanya bekerja setelah aplikasi dijalankan
                                        <strong>minimal 1x secara manual</strong> ‚Äî supaya Windows
                                        dapat mendaftarkan protokol <code>counter-eeta://</code>.
                                        Setelah itu, tombol akan berfungsi permanen. üéâ
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="how-card">
                    <h3>üîÑ &nbsp;Bagaimana Cara Kerjanya?</h3>
                    <div class="how-grid">
                        <div class="how-item">
                            <div class="how-item-head">‚ù§Ô∏è &nbsp;Heartbeat Detection</div>
                            <p>Halaman otomatis mengecek apakah app sedang berjalan. Jika terdeteksi, langsung redirect tanpa klik apapun.</p>
                        </div>
                        <div class="how-item">
                            <div class="how-item-head">üîó &nbsp;Custom URL Protocol</div>
                            <p>Protokol <code>counter-eeta://</code> terdaftar di Windows ‚Äî sama seperti Zoom atau Telegram ‚Äî sehingga app langsung terbuka lewat browser.</p>
                        </div>
                        <div class="how-item">
                            <div class="how-item-head">üõ°Ô∏è &nbsp;Privasi Terjamin</div>
                            <p>Tidak ada data yang dikirim ke server eksternal. Semua analisis berjalan lokal di komputer Anda.</p>
                        </div>
                        <div class="how-item">
                            <div class="how-item-head">‚è±Ô∏è &nbsp;Auto Shutdown</div>
                            <p>App otomatis berhenti 30 detik setelah semua tab browser ditutup, menjaga resource komputer tetap bersih.</p>
                        </div>
                    </div>
                </div>

            </div><!-- /notRunningState -->
        </div>
    </main>

    <footer class="footer">
        <div class="container-wide">
            <div class="footer-content">
                <div class="footer-brand">
                    <strong>COUNTER EETA</strong>
                    <span>Inovasi Lanjutan LKPD EETA</span>
                </div>
                <div class="footer-info">
                    <p>Dikembangkan oleh Tim Inovasi &mdash; Pemerintah Provinsi Bali</p>
                    <p class="footer-note">Untuk keperluan internal penyusunan LKPD. Data bersifat rahasia.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
    /* =========================================================
       UPDATE BANNER
    ========================================================= */
    const BANNER_VERSION = 'v0.3.0';
    const BANNER_KEY     = `ce_banner_dismissed_${BANNER_VERSION}`;

    function initBanner() {
        const dismissed = localStorage.getItem(BANNER_KEY);
        if (dismissed) {
            document.getElementById('updateBanner').classList.add('hidden');
        }
    }

    function dismissBanner() {
        localStorage.setItem(BANNER_KEY, '1');
        const banner = document.getElementById('updateBanner');
        banner.style.transition = 'opacity .3s ease, transform .3s ease, max-height .4s ease';
        banner.style.opacity    = '0';
        banner.style.transform  = 'translateY(-8px)';
        banner.style.maxHeight  = banner.offsetHeight + 'px';
        setTimeout(() => { banner.style.maxHeight = '0'; }, 50);
        setTimeout(() => { banner.classList.add('hidden'); }, 400);
    }

    initBanner();

    /* =========================================================
       CONSTANTS
    ========================================================= */
    const APP_URL         = 'http://127.0.0.1:5000';
    const CHECK_TIMEOUT   = 3000;
    const REDIRECT_DELAY  = 3;
    const WAIT_DURATION   = 30;

    /* =========================================================
       STATE
    ========================================================= */
    let countdownValue = REDIRECT_DELAY;
    let countdownTimer = null;
    let heartbeatTimer = null;
    let waitSecsLeft   = WAIT_DURATION;
    let waitBarTimer   = null;
    let waitPollTimer  = null;

    /* =========================================================
       THEME
    ========================================================= */
    function toggleTheme() {
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
        document.getElementById('themeIcon').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
    }

    /* =========================================================
       STATE MANAGER
    ========================================================= */
    function showState(id) {
        document.querySelectorAll('.state').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    /* =========================================================
       APP DETECTION
    ========================================================= */
    async function checkAppRunning() {
        try {
            const ctrl = new AbortController();
            const tid  = setTimeout(() => ctrl.abort(), CHECK_TIMEOUT);
            await fetch(APP_URL, { method: 'GET', signal: ctrl.signal, mode: 'no-cors' });
            clearTimeout(tid);
            return true;
        } catch {
            return false;
        }
    }

    /* =========================================================
       REDIRECT COUNTDOWN
    ========================================================= */
    function startCountdown() {
        const numEl = document.getElementById('countdown');
        const arc   = document.getElementById('countdownArc');
        const circ  = 201;
        countdownValue = REDIRECT_DELAY;
        numEl.textContent = countdownValue;
        arc.style.strokeDashoffset = 0;

        countdownTimer = setInterval(() => {
            countdownValue--;
            numEl.textContent = countdownValue;
            arc.style.strokeDashoffset = circ * (1 - countdownValue / REDIRECT_DELAY);
            if (countdownValue <= 0) {
                clearInterval(countdownTimer);
                redirectToApp();
            }
        }, 1000);
    }

    function redirectNow() { clearInterval(countdownTimer); redirectToApp(); }
    function redirectToApp() { window.location.href = APP_URL; }
    function reloadPage()    { window.location.reload(); }

    /* =========================================================
       LAUNCH BUTTON ‚Üí WAITING STATE
    ========================================================= */
    function onLaunchClick(e) {
        setTimeout(() => {
            showState('waitingState');
            startWaiting();
        }, 300);
    }

    /* =========================================================
       WAITING STATE
    ========================================================= */
    function startWaiting() {
        waitSecsLeft = WAIT_DURATION;
        updateWaitUI();

        waitBarTimer = setInterval(() => {
            waitSecsLeft--;
            updateWaitUI();
            if (waitSecsLeft <= 0) {
                stopWaiting();
                showState('notRunningState');
            }
        }, 1000);

        waitPollTimer = setInterval(async () => {
            const running = await checkAppRunning();
            if (running) {
                stopWaiting();
                showState('successState');
                startCountdown();
                startHeartbeat();
            }
        }, 2000);
    }

    function updateWaitUI() {
        const pct = (waitSecsLeft / WAIT_DURATION) * 100;
        document.getElementById('waitSecs').textContent     = waitSecsLeft;
        document.getElementById('waitBarFill').style.width  = pct + '%';
        document.getElementById('waitBarPct').textContent   = Math.round(pct) + '%';
    }

    function stopWaiting() {
        clearInterval(waitBarTimer); clearInterval(waitPollTimer);
        waitBarTimer = null; waitPollTimer = null;
    }

    function cancelWaiting() { stopWaiting(); showState('notRunningState'); }

    /* =========================================================
       COLLAPSE
    ========================================================= */
    function toggleCollapse() {
        document.getElementById('collapseBody').classList.toggle('open');
        document.getElementById('collapseArrow').classList.toggle('open');
    }

    /* =========================================================
       HEARTBEAT
    ========================================================= */
    function sendHeartbeat() {
        fetch(`${APP_URL}/heartbeat`, { method: 'POST', mode: 'no-cors' }).catch(() => {});
    }
    function startHeartbeat() {
        sendHeartbeat();
        heartbeatTimer = setInterval(sendHeartbeat, 10_000);
    }
    window.addEventListener('beforeunload', () => clearInterval(heartbeatTimer));

    /* =========================================================
       INIT
    ========================================================= */
    async function init() {
        const running = await checkAppRunning();
        if (running) {
            showState('successState');
            startCountdown();
            startHeartbeat();
        } else {
            showState('notRunningState');
        }
    }

    init();
    </script>
</body>
</html>
